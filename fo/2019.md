# Flare-on 2019

## 1. Memecat Battlestation
### 1.1 Stage 1
* Weapon code: RAINBOW

### 1.2 Stage 2
```python
#!/urs/bin/env python

key = ['\u0003', ' ', '&', '$', '-', '\u001e', '\u0002', ' ', '/', '/', '.', '/']

print('Weapon Code:', '.join([chr(ord(char) ^ ord('A')) for char in key]))
```
* Weapon code: Bagel_Cannon
* Flag: Kitteh_save_galixy@flare-on.com

## 2. Overlong

```shell
$ rabin2 -z Overlong.exe
[Strings]
Num Paddr      Vaddr      Len Size Section  Type  String
000 0x00000808 0x00402008  68 176 (.rdata)  utf8 I never broke the encoding: I_a_M_t_h_e_e_n_C_o_D_i_n_g@flare-on.com
001 0x000008ea 0x004020ea  11  12 (.rdata) ascii MessageBoxA
002 0x000008f6 0x004020f6  10  11 (.rdata) ascii USER32.dll
000 0x00000a00 0x00403000   6   7 (.data) ascii Output
```

* Flag: I_a_M_t_h_e_e_n_C_o_D_i_n_g@flare-on.com

## 3. Flarebear
Firstly, use [dex2jar](https://github.com/pxb1988/dex2jar) to decompile the apk file to jar file.
```shell
$ d2j-dex2jar -f flarebear.apk
```
Use [jd-gui](https://github.com/java-decompiler/jd-gui) to open created `*.jar` file, we have:
```java
public final class FlareBearActivityKt
{
  private static final int CLEAN_PER_CLEAN = 6;
  private static final int CLEAN_PER_FEED = -1;
  private static final int CLEAN_PER_PLAY = -1;
  private static final int HAPPY_PER_CLEAN = -1;
  private static final int HAPPY_PER_FEED = 2;
  private static final int HAPPY_PER_PLAY = 4;
  private static final String IV = "pawsitive_vibes!";
  private static final int MASS_PER_CLEAN = 0;
  private static final int MASS_PER_FEED = 10;
  private static final int MASS_PER_PLAY = -2;
  private static final float POOS_PER_FEED = 0.34F;
  private static final String SALT = "NaClNaClNaCl";
  private static final String TAG = "FLARE Bear";
  private static List<ImageView> poosList = (List)new ArrayList();
}

public final boolean isEcstatic()
  {
    boolean bool1 = false;
    int i = getState("mass", 0);
    int j = getState("happy", 0);
    int k = getState("clean", 0);
    boolean bool2 = bool1;
    if (i == 72)
    {
      bool2 = bool1;
      if (j == 30)
      {
        bool2 = bool1;
        if (k == 0) {
          bool2 = true;
        }
      }
    }
    return bool2;
  }

  public final boolean isHappy()
  {
    int i = getStat('f');
    int j = getStat('p');
    double d = i / j;
    boolean bool;
    if ((d >= 2.0D) && (d <= 2.5D)) {
      bool = true;
    } else {
      bool = false;
    }
    return bool;
  }

  public final void setMood()
  {
    if (isHappy())
    {
      ((ImageView)_$_findCachedViewById(R.id.flareBearImageView)).setTag("happy");
      if (isEcstatic()) {
        danceWithFlag();
      }
    }
    else
    {
      ((ImageView)_$_findCachedViewById(R.id.flareBearImageView)).setTag("sad");
    }
  }

  public final void feed(@NotNull View paramView)
  {
    Intrinsics.checkParameterIsNotNull(paramView, "view");
    saveActivity("f");
    changeMass(10);
    changeHappy(2);
    changeClean(-1);
    incrementPooCount();
    feedUi();
  }

  public final void play(@NotNull View paramView)
  {
    Intrinsics.checkParameterIsNotNull(paramView, "view");
    saveActivity("p");
    changeMass(-2);
    changeHappy(4);
    changeClean(-1);
    playUi();
  }

  public final void clean(@NotNull View paramView)
  {
    Intrinsics.checkParameterIsNotNull(paramView, "view");
    saveActivity("c");
    removePoo();
    cleanUi();
    changeMass(0);
    changeHappy(-1);
    changeClean(6);
    setMood();
  }
```

Start the app and tap 8 feeds => 4 plays => 2 cleans 

* Flag: th4t_was_be4rly_a_chall3nge@flare-on.com

Note: How to patch the apk file:
We use [apktool](https://github.com/iBotPeaches/Apktool) to decode `flarebear.apk` file:
```shell
$ apktool d flarebear.apk
```

Open `flarebare/smali/com/fireeye/flarebear/FlareBearActivity.smali` in text editor. Then overwrite the `isEcstatic` and `isHappy` method, so that they always return `0x1`.

```shell
$ apktool b flarebear
$ cd flarebear/dist
$ keytool -genkey -keystore flarebear.keystore -validity 1000 -alias bear
$ jarsigner -keystore flarebear.keystore -verbose flarebear.apk bear
```

